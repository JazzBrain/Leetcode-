# Vaa3D升级总结

### 1.更换编译器

我们使用MingW编译器代替老旧的VS编译器，这样做的原因有以下几点。

第一 : 方便进行跨平台的编译

第二 ：QT6自带MinGW，耦合更加紧密

### 2.重新编译依赖库

Vaa3D中使用到了很多的外部依赖库，比如hdf5、newmat11、szip、tiff等。在不同的操作系统下，这些相关的依赖库都需要进行重新编译。针对这些库的一些特性，我们在链接阶段同时采用了静态链接和动态链接的方式。

### 3.分离内部结构，将原始Vaa3D升级到QT6

下面介绍一些代码部分Qt4升级到Qt6中比较常见的步骤：

首先是函数库的升级，在qt6中废弃了很多qt4种的函数以及头文件，因此需要对这些函数进行重新编写以及重新包含所需要的库。

其次是一些特性的更改。比如：Qt6默认开启高分屏支持，界面会变得很大，需要进行设置。



### 4.升级TeraFly，3D模块

3D模块的升级：(dlc可以详细描述)

TeraFly模块的升级：与3D模块联系紧密，主要的显示功能就是调用3D模块进行操作的。一因此，3D模块升级之后，也就相当于解决了Terafly模块的大部分问题。此外，Terafly中使用的是throw，但是c++11已经不支持throw抛出异常，而是使用noexcept。



### 5.插件系统的升级

在Qt6中，Q_EXPORT_PLUGIN2被淘汰，需要使用Q_PLUGIN_METADATA，同时，对于每个Vaa3D的插件源码都需要进行修改并且重新编译。

### 6.成果

三个平台上均可以成功编译并且运行Vaa3D。相比于之前冗余的编译流程，升级之后的明显简洁了许多。只需要下载QT6环境，打开v3d_qt6.pro文件，在qt_creator中点击build即可直接编译成功。对于插件的编译，我们提供了脚本，在不同的平台上可使用脚本进行编译。

### 7.测试

详细的测试报告会在附录中给出。

























